/* SPDX-License-Identifier: GPL-3.0-or-later */
/*
 * Copyright 2025 Jiamu Sun <barroit@linux.com>
 */

import { commands, workspace } from 'vscode'

import { vsc_map_ctx } from './helper/vsc.js'

const {
	registerCommand: vsc_cmd,
	registerTextEditorCommand: vsc_editor_cmd
} = commands

const { getConfiguration: vsc_fetch_config } = workspace

const cmds = {
	'': [ import('./cmd/.js'), vsc_cmd        ],
	'': [ import('./cmd/.js'), vsc_editor_cmd ],
}

function fetch_config()
{
	return vsc_fetch_config('NAME')
}

export async function activate(ctx)
{
	for (const id of Object.keys(cmds)) {
		const [ module_promise, cb ] = cmds[id]
		const module = await module_promise

		const cmd_ctx = vsc_map_ctx(ctx)
		const exec = cb(`NAME.${id}`, module.exec, cmd_ctx)

		cmd_ctx.fetch_config = fetch_config
		ctx.subscriptions.push(exec)
	}
}
